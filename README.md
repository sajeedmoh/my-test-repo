# my-test-repo

A collection of web projects with a shared authentication system and central dashboard.

## Project Structure

```
my-test-repo/
├── login.html          ← Entry point (all users start here)
├── register.html       ← Create a new account
├── dashboard.html      ← Project launcher (requires login)
├── todo-list.html      ← To-Do app (requires login)
├── prayer-times.html   ← Islamic Prayer Times app
├── calculator.html     ← Web calculator
├── utilities.html      ← Exchange rates & commodity prices
├── calculator.py       ← Python calculator script
├── config.js           ← API base URL (auto-generated by deploy.sh)
└── server/             ← Node.js backend (Lambda-ready)
    ├── server.js
    ├── package.json
    ├── deploy.sh
    └── .env.example
```

---

## Authentication Architecture

### Overview

User accounts are stored in **AWS DynamoDB** and accessed via a **Node.js/Express API** deployed as an **AWS Lambda** function exposed through **API Gateway HTTP API**. The frontend (hosted on S3) calls the API for registration and login.

```
Browser (S3-hosted HTML)
        │
        │  POST /api/auth/register
        │  POST /api/auth/login
        ▼
API Gateway HTTP API  (ap-south-1)
        │
        ▼
AWS Lambda  (my-test-repo-auth, nodejs20.x)
  └─ Express app wrapped with serverless-http
        │
        ▼
AWS DynamoDB  (table: auth_users)
  └─ PK: email (string)
     Attributes: firstName, lastName, passwordHash, createdAt
```

### Registration Flow

```
User fills register.html
        │
        ▼
Client-side validation
  ├─ All fields required
  ├─ Password strength (8+ chars, upper, lower, number, special char)
  └─ Passwords match
        │
        ▼
POST /api/auth/register  →  Lambda
  ├─ Check for duplicate email in DynamoDB
  ├─ Hash password with bcrypt (12 rounds)
  └─ Save { email, firstName, lastName, passwordHash, createdAt } to DynamoDB
        │
        ▼
{ success: true }
        │
        ▼
Redirect to login.html
```

### Login Flow

```
User fills login.html
        │
        ▼
Client-side validation (email format, password length)
        │
        ▼
POST /api/auth/login  →  Lambda
  ├─ Fetch user record from DynamoDB by email
  ├─ Compare submitted password against bcrypt hash
  └─ Sign JWT token (7-day expiry) with JWT_SECRET
        │
        ▼
{ token: "eyJ...", user: { email, firstName, lastName } }
        │
        ▼
Browser stores in localStorage:
  ├─ auth_session  →  { email, firstName, lastName }
  └─ auth_token    →  JWT token
        │
        ▼
Redirect to dashboard.html
```

### Session & Auth Guard

All protected pages (`dashboard.html`, `todo-list.html`, etc.) check `localStorage.auth_session` on load and redirect to `login.html` if absent. Sign-out clears both `auth_session` and `auth_token`.

---

## User Flow

```
register.html
      │
      ▼
login.html  ──────────────→  dashboard.html
                                   │
                    ┌──────────────┼──────────────┬──────────────┐
                    ▼              ▼               ▼              ▼
              calculator.html  todo-list.html  prayer-times.html utilities.html
                    │              │               │               │
                    └──────────────┴───────────────┴───────────────┘
                                              │
                                       ← Back to Dashboard
```

---

## Pages

### `login.html` — Login
- Calls `POST /api/auth/login` to verify credentials via DynamoDB
- Live field validation on blur
- Redirects already-logged-in users straight to the dashboard
- On success, saves session + JWT to `localStorage` and navigates to `dashboard.html`

### `register.html` — Registration
- Collects first name, last name, email, and password
- Real-time password strength meter with 5 validation rules
- Calls `POST /api/auth/register` — duplicate email check and bcrypt hashing happen server-side
- On success redirects to `login.html`

### `dashboard.html` — Project Dashboard
- Auth-guarded: redirects to login if no session exists
- Left sidebar with vertical project tiles (Calculator, Todo List, Prayer Times, Utilities)
- Personalised greeting using the logged-in user's name (adapts to time of day)
- Live clock and date in the top bar
- Sign out button clears session and returns to login

---

## Projects

### To-Do List (`todo-list.html`)
A protected task management app. Requires login to access.

**Features:**
- Add, edit, complete, and delete tasks
- Filter by All / Active / Done
- Per-user task storage in `localStorage` (keyed by email)
- Auth guard — redirects to login without a session

### Islamic Prayer Times (`prayer-times.html`)
A full-featured Islamic prayer times web app.

| Feature | Detail |
|---------|--------|
| Prayer times | Fajr, Dhuhr, Asr, Maghrib, Isha with Adhan times |
| Iqama times | +20 min for all prayers, +5 min for Maghrib |
| Next Prayer / Iqama | Live countdown banners |
| Calculation methods | 16 selectable (MWL, ISNA, Umm Al-Qura, etc.) |
| Asr school | Standard or Hanafi |
| Location | City + Country input, or GPS auto-detect |
| Hijri date | Displayed in the info bar |
| Ramzan Fasting banner | Day number, progress bar, days remaining |

**Prayer times API:** [Aladhan API](https://aladhan.com) (free, no key required)

### Calculator (`calculator.html`)
Browser-based calculator with history. Also available as `calculator.py` (Python/Tkinter desktop app).

### Utilities (`utilities.html`)
Live financial data — USD/INR, AED/INR exchange rates and gold/silver spot prices with converters.

**APIs:** [@fawazahmed0/currency-api](https://github.com/fawazahmed0/exchange-api) (free, no key required)

---

## AWS Resources

| Resource | Name / ID | Purpose |
|----------|-----------|---------|
| DynamoDB table | `auth_users` (ap-south-1) | Stores user accounts |
| Lambda function | `my-test-repo-auth` (nodejs20.x) | Runs the Express auth API |
| Lambda execution role | `my-test-repo-lambda-role` | Grants Lambda access to DynamoDB and CloudWatch |
| API Gateway HTTP API | `my-test-repo-api` (ap-south-1) | Public HTTPS endpoint for the Lambda |
| S3 bucket | `sajeedmoh-my-projects` | Hosts the static HTML files |

### API Endpoints

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/api/auth/register` | Create a new user account |
| `POST` | `/api/auth/login` | Authenticate and receive a JWT |

---

## Backend Setup

### Prerequisites
- Node.js 18+
- AWS account with DynamoDB, Lambda, and API Gateway access

### Local development

```bash
cd server
cp .env.example .env
# Fill in your AWS credentials and JWT_SECRET in .env
npm install
node server.js
# Open http://localhost:3000/login.html
```

### Deploy to Lambda + API Gateway

```bash
cd server
bash deploy.sh
```

The script will:
1. Verify / create the IAM execution role
2. Package and upload the code to Lambda
3. Create or update the API Gateway HTTP API
4. Write the API URL into `config.js` and upload it to S3

> **Note:** Set `LAMBDA_ROLE_ARN` in `.env` if your IAM user cannot create roles automatically.

---

## Tech Stack

| Layer | Technology |
|-------|-----------|
| Frontend | Plain HTML, CSS, JavaScript (no frameworks) |
| Backend | Node.js, Express, serverless-http |
| Auth | bcryptjs (password hashing), jsonwebtoken (sessions) |
| Database | AWS DynamoDB |
| Hosting | AWS S3 (static), AWS Lambda + API Gateway (backend) |
| Prayer times | Aladhan REST API |
| Exchange rates | @fawazahmed0/currency-api |

## License

This repository is for personal testing and learning purposes.
