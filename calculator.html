<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculator</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:       #0f1117;
      --surface:  #1a1d27;
      --border:   rgba(255,255,255,0.08);
      --text:     #f0f0f0;
      --muted:    rgba(240,240,240,0.45);
      --accent:   #f97316;
      --key-bg:   #22263a;
      --key-op:   rgba(249,115,22,0.15);
      --key-eq:   #f97316;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px 16px 40px;
    }

    /* ── Back bar ──────────────────────────────────── */
    .back-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
      background: rgba(15,17,23,0.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      padding: 0 20px;
      height: 44px;
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 0.82rem;
      color: var(--muted);
      text-decoration: none;
      transition: color 0.18s;
    }

    .back-link:hover { color: var(--accent); }

    /* ── Calculator shell ──────────────────────────── */
    .calc {
      width: 100%;
      max-width: 340px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: 0 24px 60px rgba(0,0,0,0.5);
    }

    /* ── Display ───────────────────────────────────── */
    .display {
      padding: 28px 24px 16px;
      background: rgba(0,0,0,0.25);
      border-bottom: 1px solid var(--border);
      text-align: right;
    }

    .display .expr {
      font-size: 0.85rem;
      color: var(--muted);
      min-height: 1.2em;
      word-break: break-all;
      margin-bottom: 6px;
    }

    .display .result {
      font-size: 2.8rem;
      font-weight: 300;
      font-variant-numeric: tabular-nums;
      letter-spacing: -0.02em;
      line-height: 1;
      color: var(--text);
      word-break: break-all;
      transition: font-size 0.1s;
    }

    .display .result.small { font-size: 1.8rem; }

    /* ── History strip ─────────────────────────────── */
    .history-strip {
      padding: 8px 20px;
      font-size: 0.72rem;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
      min-height: 32px;
      display: flex;
      align-items: center;
      gap: 6px;
      overflow-x: auto;
      white-space: nowrap;
    }

    .history-strip .hist-item {
      cursor: pointer;
      padding: 2px 8px;
      border-radius: 4px;
      border: 1px solid var(--border);
      transition: background 0.15s;
      flex-shrink: 0;
    }

    .history-strip .hist-item:hover { background: rgba(255,255,255,0.07); }

    /* ── Button grid ───────────────────────────────── */
    .keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1px;
      background: var(--border);
    }

    .key {
      background: var(--key-bg);
      border: none;
      color: var(--text);
      font-size: 1.15rem;
      font-family: inherit;
      font-weight: 500;
      padding: 0;
      height: 70px;
      cursor: pointer;
      transition: background 0.12s, transform 0.08s;
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .key:active { transform: scale(0.93); }

    /* Variants */
    .key.op {
      background: var(--key-op);
      color: var(--accent);
      font-weight: 600;
    }

    .key.fn {
      background: rgba(255,255,255,0.04);
      color: var(--muted);
      font-size: 0.95rem;
    }

    .key.eq {
      background: var(--key-eq);
      color: #fff;
      font-size: 1.4rem;
      font-weight: 700;
    }

    .key.zero { grid-column: span 2; justify-content: flex-start; padding-left: 28px; }

    .key:hover { filter: brightness(1.15); }
    .key.eq:hover { filter: brightness(1.1); }

    /* ── Footer ────────────────────────────────────── */
    .calc-footer {
      font-size: 0.7rem;
      color: rgba(240,240,240,0.15);
      margin-top: 20px;
      text-align: center;
    }
  </style>
</head>
<body>

<!-- Back to Dashboard -->
<nav class="back-bar">
  <a href="dashboard.html" class="back-link">&#8592; Back to Dashboard</a>
</nav>

<div class="calc">

  <!-- Display -->
  <div class="display">
    <div class="expr" id="expr"></div>
    <div class="result" id="result">0</div>
  </div>

  <!-- History -->
  <div class="history-strip" id="historyStrip">
    <span style="color:rgba(240,240,240,0.2)">History</span>
  </div>

  <!-- Keys -->
  <div class="keys">
    <!-- Row 1 -->
    <button class="key fn" data-action="clear">AC</button>
    <button class="key fn" data-action="sign">+/−</button>
    <button class="key fn" data-action="percent">%</button>
    <button class="key op" data-action="op" data-op="÷">÷</button>

    <!-- Row 2 -->
    <button class="key" data-action="digit" data-val="7">7</button>
    <button class="key" data-action="digit" data-val="8">8</button>
    <button class="key" data-action="digit" data-val="9">9</button>
    <button class="key op" data-action="op" data-op="×">×</button>

    <!-- Row 3 -->
    <button class="key" data-action="digit" data-val="4">4</button>
    <button class="key" data-action="digit" data-val="5">5</button>
    <button class="key" data-action="digit" data-val="6">6</button>
    <button class="key op" data-action="op" data-op="−">−</button>

    <!-- Row 4 -->
    <button class="key" data-action="digit" data-val="1">1</button>
    <button class="key" data-action="digit" data-val="2">2</button>
    <button class="key" data-action="digit" data-val="3">3</button>
    <button class="key op" data-action="op" data-op="+">+</button>

    <!-- Row 5 -->
    <button class="key zero" data-action="digit" data-val="0">0</button>
    <button class="key" data-action="decimal">.</button>
    <button class="key eq" data-action="equals">=</button>
  </div>

</div>

<div class="calc-footer">Keyboard supported &bull; Click history entries to reuse</div>

<script>
  /* ── State ──────────────────────────────────── */
  let current  = '0';   // number being typed
  let prev     = '';    // previous operand
  let operator = '';    // pending operator
  let justEvaled = false;
  const history = [];   // [{expr, result}]

  /* ── DOM refs ───────────────────────────────── */
  const resultEl  = document.getElementById('result');
  const exprEl    = document.getElementById('expr');
  const histEl    = document.getElementById('historyStrip');

  /* ── Helpers ─────────────────────────────────── */
  function fmt(n) {
    const num = parseFloat(n);
    if (isNaN(num)) return 'Error';
    // Avoid scientific notation for reasonable numbers
    if (Math.abs(num) < 1e15 && Math.abs(num) > 1e-7 || num === 0) {
      const s = parseFloat(num.toPrecision(12)).toString();
      return s;
    }
    return num.toExponential(6);
  }

  function render() {
    const display = fmt(current);
    resultEl.textContent = display;
    resultEl.className   = 'result' + (display.length > 9 ? ' small' : '');
  }

  function applyOp(a, op, b) {
    const x = parseFloat(a), y = parseFloat(b);
    switch (op) {
      case '+': return x + y;
      case '−': return x - y;
      case '×': return x * y;
      case '÷': return y === 0 ? 'Error' : x / y;
    }
  }

  function pushHistory(expr, res) {
    history.unshift({ expr, res });
    if (history.length > 10) history.pop();
    renderHistory();
  }

  function renderHistory() {
    histEl.innerHTML = '<span style="color:rgba(240,240,240,0.2);flex-shrink:0">History</span>';
    history.forEach(h => {
      const el = document.createElement('span');
      el.className = 'hist-item';
      el.textContent = `${h.expr} = ${h.res}`;
      el.title = 'Reuse result';
      el.addEventListener('click', () => {
        current = h.res.toString();
        prev = ''; operator = ''; justEvaled = true;
        exprEl.textContent = '';
        render();
      });
      histEl.appendChild(el);
    });
  }

  /* ── Actions ─────────────────────────────────── */
  function digit(val) {
    if (justEvaled) { current = val; justEvaled = false; return; }
    if (current === '0' && val !== '.') { current = val; return; }
    if (val === '0' && current === '0') return;
    if (current.length >= 15) return;
    current += val;
  }

  function decimal() {
    if (justEvaled) { current = '0.'; justEvaled = false; return; }
    if (!current.includes('.')) current += '.';
  }

  function op(o) {
    if (operator && !justEvaled) {
      const res = applyOp(prev, operator, current);
      current = fmt(res);
    }
    prev     = current;
    operator = o;
    current  = '0';
    justEvaled = false;
    exprEl.textContent = `${prev} ${operator}`;
  }

  function equals() {
    if (!operator) return;
    const expr = `${prev} ${operator} ${current}`;
    const res  = applyOp(prev, operator, current);
    const resStr = fmt(res);
    pushHistory(expr, resStr);
    exprEl.textContent = expr + ' =';
    current  = resStr;
    prev     = '';
    operator = '';
    justEvaled = true;
  }

  function clear() {
    current = '0'; prev = ''; operator = '';
    justEvaled = false;
    exprEl.textContent = '';
  }

  function sign() {
    if (current === '0') return;
    current = fmt(parseFloat(current) * -1);
  }

  function percent() {
    current = fmt(parseFloat(current) / 100);
  }

  /* ── Button clicks ───────────────────────────── */
  document.querySelectorAll('.key').forEach(btn => {
    btn.addEventListener('click', () => {
      const action = btn.dataset.action;
      if (action === 'digit')   digit(btn.dataset.val);
      if (action === 'decimal') decimal();
      if (action === 'op')      op(btn.dataset.op);
      if (action === 'equals')  equals();
      if (action === 'clear')   clear();
      if (action === 'sign')    sign();
      if (action === 'percent') percent();
      render();
    });
  });

  /* ── Keyboard support ────────────────────────── */
  document.addEventListener('keydown', e => {
    if (e.key >= '0' && e.key <= '9') { digit(e.key); render(); }
    else if (e.key === '.')  { decimal(); render(); }
    else if (e.key === '+')  { op('+'); render(); }
    else if (e.key === '-')  { op('−'); render(); }
    else if (e.key === '*')  { op('×'); render(); }
    else if (e.key === '/')  { e.preventDefault(); op('÷'); render(); }
    else if (e.key === 'Enter' || e.key === '=') { equals(); render(); }
    else if (e.key === 'Escape') { clear(); render(); }
    else if (e.key === 'Backspace') {
      if (current.length > 1) current = current.slice(0, -1);
      else current = '0';
      render();
    }
  });

  render();
</script>
</body>
</html>
