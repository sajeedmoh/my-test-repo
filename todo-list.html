<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>To-Do List</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f0f2f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 40px 16px;
    }

    .app {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 520px;
      padding: 32px;
      height: fit-content;
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    h1 {
      font-size: 1.6rem;
      font-weight: 700;
      color: #1a1a2e;
      margin-bottom: 0;
    }



    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .input-row input {
      flex: 1;
      padding: 10px 14px;
      border: 1.5px solid #e0e0e0;
      border-radius: 8px;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.2s;
    }

    .input-row input:focus { border-color: #4f8ef7; }

    .btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }

    .btn:active { transform: scale(0.97); }

    .btn-add {
      background: #4f8ef7;
      color: #fff;
      white-space: nowrap;
    }

    .btn-add:hover { background: #3a7ae0; }

    .filters {
      display: flex;
      gap: 6px;
      margin-bottom: 20px;
    }

    .filter-btn {
      padding: 5px 12px;
      border: 1.5px solid #e0e0e0;
      border-radius: 20px;
      background: none;
      font-size: 0.82rem;
      cursor: pointer;
      color: #666;
      transition: all 0.2s;
    }

    .filter-btn.active {
      background: #4f8ef7;
      border-color: #4f8ef7;
      color: #fff;
    }

    .task-list { list-style: none; }

    .task-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 10px;
      border-bottom: 1px solid #f0f0f0;
      animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }

    .task-item:last-child { border-bottom: none; }

    .task-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #4f8ef7;
      flex-shrink: 0;
    }

    .task-text {
      flex: 1;
      font-size: 0.95rem;
      color: #2c2c2c;
      word-break: break-word;
    }

    .task-text.done {
      text-decoration: line-through;
      color: #aaa;
    }

    .task-edit-input {
      flex: 1;
      padding: 4px 8px;
      border: 1.5px solid #4f8ef7;
      border-radius: 6px;
      font-size: 0.95rem;
      outline: none;
    }

    .task-actions { display: flex; gap: 4px; flex-shrink: 0; }

    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px 6px;
      border-radius: 6px;
      font-size: 1rem;
      line-height: 1;
      transition: background 0.15s;
    }

    .icon-btn:hover { background: #f0f2f5; }

    .icon-btn.save { color: #22c55e; }
    .icon-btn.edit { color: #4f8ef7; }
    .icon-btn.delete { color: #ef4444; }
    .icon-btn.cancel { color: #888; }

    .empty {
      text-align: center;
      color: #bbb;
      font-size: 0.9rem;
      padding: 32px 0;
    }

    .footer {
      margin-top: 16px;
      font-size: 0.8rem;
      color: #aaa;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .clear-btn {
      background: none;
      border: none;
      color: #ef4444;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .clear-btn:hover { text-decoration: underline; }

    /* â”€â”€ Back to dashboard bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .back-bar {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 100;
      background: rgba(15,17,23,0.92);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      padding: 0 20px;
      height: 44px;
    }

    .back-link {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 0.82rem;
      color: rgba(240,240,240,0.55);
      text-decoration: none;
      transition: color 0.18s;
    }

    .back-link:hover { color: #f0f0f0; }

    .back-link .chevron {
      font-size: 0.85rem;
      line-height: 1;
    }

    body { padding-top: 44px; }
  </style>
</head>
<body>
  <nav class="back-bar">
    <a href="dashboard.html" class="back-link">
      <span class="chevron">&#8592;</span> Back to Dashboard
    </a>
  </nav>

  <div class="app">
    <div class="app-header">
      <h1>To-Do List</h1>

    </div>

    <div class="input-row">
      <input type="text" id="taskInput" placeholder="Add a new task..." maxlength="200" />
      <button class="btn btn-add" id="addBtn">Add</button>
    </div>

    <div class="filters">
      <button class="filter-btn active" data-filter="all">All</button>
      <button class="filter-btn" data-filter="active">Active</button>
      <button class="filter-btn" data-filter="done">Done</button>
    </div>

    <ul class="task-list" id="taskList"></ul>

    <div class="footer">
      <span id="taskCount"></span>
      <button class="clear-btn" id="clearDoneBtn">Clear completed</button>
    </div>
  </div>

  <script>
    // Auth guard â€” redirect to login if no session
    const session = JSON.parse(localStorage.getItem('auth_session') || 'null');
    if (!session) {
      window.location.replace('login.html');
    }



    // Scope tasks per user
    const STORAGE_KEY = `todo_tasks_${session.email}`;
    let tasks = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
    let filter = 'all';

    const taskInput = document.getElementById('taskInput');
    const taskList  = document.getElementById('taskList');
    const taskCount = document.getElementById('taskCount');

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
    }

    function render() {
      const filtered = tasks.filter(t => {
        if (filter === 'active') return !t.done;
        if (filter === 'done')   return t.done;
        return true;
      });

      taskList.innerHTML = '';

      if (filtered.length === 0) {
        taskList.innerHTML = '<li class="empty">No tasks here.</li>';
      } else {
        filtered.forEach(task => {
          taskList.appendChild(buildItem(task));
        });
      }

      const remaining = tasks.filter(t => !t.done).length;
      taskCount.textContent = `${remaining} task${remaining !== 1 ? 's' : ''} left`;
    }

    function buildItem(task) {
      const li = document.createElement('li');
      li.className = 'task-item';
      li.dataset.id = task.id;

      if (task.editing) {
        // Edit mode
        const input = document.createElement('input');
        input.className = 'task-edit-input';
        input.value = task.text;
        input.maxLength = 200;

        const saveBtn = document.createElement('button');
        saveBtn.className = 'icon-btn save';
        saveBtn.title = 'Save';
        saveBtn.textContent = 'âœ“';
        saveBtn.onclick = () => commitEdit(task.id, input.value);

        const cancelBtn = document.createElement('button');
        cancelBtn.className = 'icon-btn cancel';
        cancelBtn.title = 'Cancel';
        cancelBtn.textContent = 'âœ•';
        cancelBtn.onclick = () => cancelEdit(task.id);

        input.onkeydown = e => {
          if (e.key === 'Enter') commitEdit(task.id, input.value);
          if (e.key === 'Escape') cancelEdit(task.id);
        };

        const actions = document.createElement('div');
        actions.className = 'task-actions';
        actions.append(saveBtn, cancelBtn);

        li.append(input, actions);
        setTimeout(() => { input.focus(); input.select(); }, 0);
      } else {
        // View mode
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.className = 'task-checkbox';
        cb.checked = task.done;
        cb.onchange = () => toggleDone(task.id);

        const span = document.createElement('span');
        span.className = 'task-text' + (task.done ? ' done' : '');
        span.textContent = task.text;
        span.ondblclick = () => startEdit(task.id);

        const editBtn = document.createElement('button');
        editBtn.className = 'icon-btn edit';
        editBtn.title = 'Edit';
        editBtn.textContent = 'âœŽ';
        editBtn.onclick = () => startEdit(task.id);

        const delBtn = document.createElement('button');
        delBtn.className = 'icon-btn delete';
        delBtn.title = 'Delete';
        delBtn.textContent = 'ðŸ—‘';
        delBtn.onclick = () => deleteTask(task.id);

        const actions = document.createElement('div');
        actions.className = 'task-actions';
        actions.append(editBtn, delBtn);

        li.append(cb, span, actions);
      }

      return li;
    }

    function addTask() {
      const text = taskInput.value.trim();
      if (!text) return;
      tasks.push({ id: Date.now(), text, done: false, editing: false });
      taskInput.value = '';
      save();
      render();
    }

    function toggleDone(id) {
      const t = tasks.find(t => t.id === id);
      if (t) { t.done = !t.done; save(); render(); }
    }

    function deleteTask(id) {
      tasks = tasks.filter(t => t.id !== id);
      save();
      render();
    }

    function startEdit(id) {
      tasks.forEach(t => t.editing = false);
      const t = tasks.find(t => t.id === id);
      if (t) { t.editing = true; render(); }
    }

    function commitEdit(id, value) {
      const text = value.trim();
      const t = tasks.find(t => t.id === id);
      if (t) {
        if (text) t.text = text;
        t.editing = false;
        save();
        render();
      }
    }

    function cancelEdit(id) {
      const t = tasks.find(t => t.id === id);
      if (t) { t.editing = false; render(); }
    }

    // Event listeners
    document.getElementById('addBtn').onclick = addTask;

    taskInput.onkeydown = e => { if (e.key === 'Enter') addTask(); };

    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.onclick = () => {
        filter = btn.dataset.filter;
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        render();
      };
    });

    document.getElementById('clearDoneBtn').onclick = () => {
      tasks = tasks.filter(t => !t.done);
      save();
      render();
    };

    render();
  </script>
</body>
</html>
